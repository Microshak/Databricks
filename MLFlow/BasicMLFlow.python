{"version":"NotebookV1","origId":542818527689304,"name":"BasicMLFlow","language":"python","commands":[{"version":"CommandV1","origId":542818527689305,"guid":"0bd6a7e7-9378-471a-b52a-4bc0a24fea35","subtype":"command","commandType":"auto","position":1.0,"command":"import mlflow\n\n","commandVersion":2,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1559785684897,"submitTime":1559785684711,"finishTime":1559785684918,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"v-roshmi@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e6bc702e-f2b6-4dee-9235-2183501114e7"},{"version":"CommandV1","origId":542818527689309,"guid":"bbe11351-0af9-47a3-ae49-0701f3fdcd60","subtype":"command","commandType":"auto","position":2.0,"command":"# Start an MLflow run\n\nwith mlflow.start_run():\n  mlflow.set_experiment(\"/Shared/experiments/Basics\")\n  # Log a parameter (key-value pair)\n  mlflow.log_param(\"param1\", 4)\n\n  # Log a metric; metrics can be updated throughout the run\n\n  mlflow.log_metric(\"foo\", 1)\n  mlflow.log_metric(\"foo\", 2)\n  mlflow.log_metric(\"foo\", 5)\n\n  # Log an artifact (output file)\n  with open(\"output.txt\", \"w\") as f:\n      f.write(\"Hello world!\")\n  mlflow.log_artifact(\"output.txt\")","commandVersion":14,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">RestException</span>: RESOURCE_DOES_NOT_EXIST: Parent directory /Shared/MLFlow does not exist.","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">RestException</span>                             Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;command-542818527689309&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">      2</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      3</span> <span class=\"ansigreen\">with</span> mlflow<span class=\"ansiyellow\">.</span>start_run<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">----&gt; 4</span><span class=\"ansiyellow\">   </span>mlflow<span class=\"ansiyellow\">.</span>set_experiment<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;/Shared/MLFlow/BasicMLFlow&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      5</span>   <span class=\"ansired\"># Log a parameter (key-value pair)</span><span class=\"ansiyellow\"></span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      6</span>   mlflow<span class=\"ansiyellow\">.</span>log_param<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;param1&quot;</span><span class=\"ansiyellow\">,</span> <span class=\"ansicyan\">4</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/python/lib/python3.5/site-packages/mlflow/tracking/fluent.py</span> in <span class=\"ansicyan\">set_experiment</span><span class=\"ansiblue\">(experiment_name)</span>\n<span class=\"ansigreen\">     44</span>     <span class=\"ansigreen\">if</span> exp_id <span class=\"ansigreen\">is</span> <span class=\"ansigreen\">None</span><span class=\"ansiyellow\">:</span>  <span class=\"ansired\"># id can be 0</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     45</span>         print<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;INFO: &apos;{}&apos; does not exist. Creating a new experiment&quot;</span><span class=\"ansiyellow\">.</span>format<span class=\"ansiyellow\">(</span>experiment_name<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 46</span><span class=\"ansiyellow\">         </span>exp_id <span class=\"ansiyellow\">=</span> client<span class=\"ansiyellow\">.</span>create_experiment<span class=\"ansiyellow\">(</span>experiment_name<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     47</span>     <span class=\"ansigreen\">elif</span> experiment<span class=\"ansiyellow\">.</span>lifecycle_stage <span class=\"ansiyellow\">==</span> LifecycleStage<span class=\"ansiyellow\">.</span>DELETED<span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     48</span>         raise MlflowException(\n\n<span class=\"ansigreen\">/databricks/python/lib/python3.5/site-packages/mlflow/tracking/client.py</span> in <span class=\"ansicyan\">create_experiment</span><span class=\"ansiblue\">(self, name, artifact_location)</span>\n<span class=\"ansigreen\">    126</span>         return self.store.create_experiment(\n<span class=\"ansigreen\">    127</span>             name<span class=\"ansiyellow\">=</span>name<span class=\"ansiyellow\">,</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">--&gt; 128</span><span class=\"ansiyellow\">             </span>artifact_location<span class=\"ansiyellow\">=</span>artifact_location<span class=\"ansiyellow\">,</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    129</span>         )\n<span class=\"ansigreen\">    130</span> <span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/python/lib/python3.5/site-packages/mlflow/store/rest_store.py</span> in <span class=\"ansicyan\">create_experiment</span><span class=\"ansiblue\">(self, name, artifact_location)</span>\n<span class=\"ansigreen\">     93</span>         req_body = message_to_json(CreateExperiment(\n<span class=\"ansigreen\">     94</span>             name=name, artifact_location=artifact_location))\n<span class=\"ansigreen\">---&gt; 95</span><span class=\"ansiyellow\">         </span>response_proto <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>_call_endpoint<span class=\"ansiyellow\">(</span>CreateExperiment<span class=\"ansiyellow\">,</span> req_body<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     96</span>         <span class=\"ansigreen\">return</span> response_proto<span class=\"ansiyellow\">.</span>experiment_id<span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     97</span> <span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/python/lib/python3.5/site-packages/mlflow/store/rest_store.py</span> in <span class=\"ansicyan\">_call_endpoint</span><span class=\"ansiblue\">(self, api, json_body)</span>\n<span class=\"ansigreen\">     67</span>                 host_creds=host_creds, endpoint=endpoint, method=method, json=json_body)\n<span class=\"ansigreen\">     68</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 69</span><span class=\"ansiyellow\">         </span>response <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>_verify_rest_response<span class=\"ansiyellow\">(</span>response<span class=\"ansiyellow\">,</span> endpoint<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     70</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     71</span>         js_dict <span class=\"ansiyellow\">=</span> json<span class=\"ansiyellow\">.</span>loads<span class=\"ansiyellow\">(</span>response<span class=\"ansiyellow\">.</span>text<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/python/lib/python3.5/site-packages/mlflow/store/rest_store.py</span> in <span class=\"ansicyan\">_verify_rest_response</span><span class=\"ansiblue\">(self, response, endpoint)</span>\n<span class=\"ansigreen\">     50</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     51</span>     <span class=\"ansigreen\">def</span> _verify_rest_response<span class=\"ansiyellow\">(</span>self<span class=\"ansiyellow\">,</span> response<span class=\"ansiyellow\">,</span> endpoint<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 52</span><span class=\"ansiyellow\">         </span><span class=\"ansigreen\">return</span> verify_rest_response<span class=\"ansiyellow\">(</span>response<span class=\"ansiyellow\">,</span> endpoint<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     53</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     54</span>     <span class=\"ansigreen\">def</span> _call_endpoint<span class=\"ansiyellow\">(</span>self<span class=\"ansiyellow\">,</span> api<span class=\"ansiyellow\">,</span> json_body<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/python/lib/python3.5/site-packages/mlflow/utils/rest_utils.py</span> in <span class=\"ansicyan\">verify_rest_response</span><span class=\"ansiblue\">(response, endpoint)</span>\n<span class=\"ansigreen\">     82</span>                    <span class=\"ansiblue\">&quot;%s != 200&quot;</span> <span class=\"ansiyellow\">%</span> <span class=\"ansiyellow\">(</span>endpoint<span class=\"ansiyellow\">,</span> response<span class=\"ansiyellow\">.</span>status_code<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     83</span>         <span class=\"ansigreen\">if</span> _can_parse_as_json<span class=\"ansiyellow\">(</span>response<span class=\"ansiyellow\">.</span>text<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 84</span><span class=\"ansiyellow\">             </span><span class=\"ansigreen\">raise</span> RestException<span class=\"ansiyellow\">(</span>json<span class=\"ansiyellow\">.</span>loads<span class=\"ansiyellow\">(</span>response<span class=\"ansiyellow\">.</span>text<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     85</span>         <span class=\"ansigreen\">raise</span> MlflowException<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;%s. Response body: &apos;%s&apos;&quot;</span> <span class=\"ansiyellow\">%</span> <span class=\"ansiyellow\">(</span>base_msg<span class=\"ansiyellow\">,</span> response<span class=\"ansiyellow\">.</span>text<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     86</span>     <span class=\"ansigreen\">return</span> response<span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">RestException</span>: RESOURCE_DOES_NOT_EXIST: Parent directory /Shared/MLFlow does not exist.</div>","workflows":[],"startTime":1559785714180,"submitTime":1559785714145,"finishTime":1559785722228,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"v-roshmi@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"3b05f7eb-ceec-4c40-8ad8-1cd1e97a755b"},{"version":"CommandV1","origId":542818527689310,"guid":"e8140360-6d99-4c4c-b2d2-8d4d4738e08e","subtype":"command","commandType":"auto","position":3.0,"command":"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"269f9d61-cde0-4b14-93f3-8b3d7c4c6121"}],"dashboards":[],"guid":"28bd74d8-6829-4f5c-acfc-d6b6ff8e8d38","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}